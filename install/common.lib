#!/bin/bash

SCRIPT_DIR=$(dirname "$(realpath "$0")")
PROJECT_DIR=$(dirname "$SCRIPT_DIR")
source "$SCRIPT_DIR/printlog.lib"
source "$SCRIPT_DIR/filepaths.lib"

# Try to run a command, if it doesnt work, try using sudo instead
# (Intended for file operations)
run_or_sudo() {
    local cmd=("$@")
    local output
    local error

    # Attempt to run the command normally
    output=$(eval "${cmd[@]}" 2>/dev/null)
    error=$(eval "${cmd[@]}" 2>&1 >/dev/null)

    # If the command fails, run it with sudo
    if [ $? -ne 0 ]; then
        output=$(sudo "${cmd[@]}" 2>/dev/null)
        error=$(sudo "${cmd[@]}" 2>&1 >/dev/null)
    fi

    # Check if there was an error
    if [ -n "$error" ]; then
        print_error "$error"
        echo "$output"
        return 1
    fi

    echo "$output"
}
